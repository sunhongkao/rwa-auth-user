"use strict";(self.webpackChunkprivy_atuh=self.webpackChunkprivy_atuh||[]).push([[3184],{43184(e,s,r){r.r(s),r.d(s,{EmbeddedWalletPasswordUpdateScreen:()=>c,default:()=>c});var t=r(85089),a=r(58661),o=r(52034),d=r(87931),n=r(14766),l=r(90541),i=r(51870);r(72025),r(15546),r(99130),r(92037),r(33523);const c={component:()=>{let[e,s]=(0,a.useState)(null),[r,c]=(0,a.useState)(!1),[u,v]=(0,a.useState)(null),[w,y]=(0,a.useState)(""),{authenticated:p,user:h}=(0,o.u)(),{client:g,walletProxy:_,refreshSessionAndUser:m,closePrivyModal:f,createAnalyticsEvent:M}=(0,n.u)(),{navigate:b,data:R,onUserCloseViaDialogOrKeybindRef:A}=(0,o.a)(),S=(0,d.u)(),{onSuccess:P,onFailure:C}=R.setWalletPassword,E=(0,o.g)(h),x="user-passcode"===(null===e||void 0===e?void 0:e.recoveryMethod),k="user-passcode"===(null===E||void 0===E?void 0:E.recoveryMethod);(0,a.useEffect)(()=>{p||(b("LandingScreen"),C(new n.o("User must be authenticated before setting a password on a Privy wallet")))},[p]);let N=()=>u?(C(u),void f({shouldCallAuthOnSuccess:!1})):x?(P(e),void f({shouldCallAuthOnSuccess:!1})):(C(new n.m("Exited before password was added to wallet")),void f({shouldCallAuthOnSuccess:!1}));return A.current=N,(0,t.jsx)(i.S,{appName:(null===S||void 0===S?void 0:S.name)||"privy",config:{initiatedBy:"user",onCancel:N},error:u?"An error has occurred, please try again.":void 0,buttonLoading:r,buttonHideAnimations:!1,password:w,isResettingPassword:k,onPasswordGenerate:()=>y((0,i.g)()),onPasswordChange:y,onSubmit:async()=>{x?(P(e),f({shouldCallAuthOnSuccess:!1})):(c(!0),v(null),await(async()=>{let e=await g.getAccessToken();if(e&&h&&null!==E&&void 0!==E&&E.address&&w&&_)try{M({eventName:"embedded_wallet_set_recovery_started",payload:{walletAddress:E.address,existingRecoveryMethod:E.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:k}});let{entropyId:r,entropyIdVerifier:t}=(0,l.g)(h);if(!(await _.setRecovery({accessToken:e,entropyId:r,entropyIdVerifier:t,recoveryPassword:w,recoveryMethod:"user-passcode"})).entropyId)return v(new n.m("Error setting password on privy wallet")),void M({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:E.address,existingRecoveryMethod:E.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:k,reason:"error setting password"}});let a=await m(),d=(0,o.g)(a);if(!d)return v(new n.m("Error setting password on privy wallet")),void M({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:E.address,existingRecoveryMethod:E.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:k,reason:"wallet disconnected"}});s(d),M({eventName:"embedded_wallet_set_recovery_completed",payload:{walletAddress:E.address,existingRecoveryMethod:E.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:k}})}catch(e){console.warn(e),v(e instanceof Error?e:Error("Error setting password on privy wallet")),M({eventName:"embedded_wallet_set_password_failed",payload:{walletAddress:E.address,reason:e}})}})(),c(!1))},onClose:N})}}}}]);