"use strict";(self.webpackChunkprivy_atuh=self.webpackChunkprivy_atuh||[]).push([[7085],{67085(e,t,r){r.r(t),r.d(t,{EmbeddedWalletConnectingScreen:()=>y,EmbeddedWalletConnectingView:()=>u,default:()=>y});var a=r(24107),o=r(85089),n=r(2154),l=r(58661),i=r(97916),c=r(14766),s=r(52034),d=r(99743);r(99130),r(72025),r(15546),r(15656),r(56348);const u=e=>{let{connectionFailed:t,onClose:r}=e;return(0,o.jsx)(d.S,t?{title:"Something went wrong",subtitle:"We're on it. Please try again later.",icon:n.A,iconVariant:"error",primaryCta:{label:"Close",onClick:r},watermark:!0}:{title:"Connecting to your wallet",subtitle:"Please wait...",iconVariant:"loading",showClose:!0,onClose:r,watermark:!1})},y={component:()=>{let{authenticated:e,user:t}=(0,s.u)(),{client:r,closePrivyModal:n,createAnalyticsEvent:d,walletProxy:y}=(0,c.u)(),{navigate:v,data:p,setModalData:h,onUserCloseViaDialogOrKeybindRef:w}=(0,s.a)(),f=(0,l.useMemo)(()=>Date.now(),[]),[b,m]=(0,l.useState)(!1),{onCompleteNavigateTo:C,onFailure:g,shouldForceMFA:A,entropyId:k,entropyIdVerifier:I,recoveryMethod:S,connectingWalletAddress:E,isUnifiedWallet:T=!1}=null===p||void 0===p?void 0:p.connectWallet,V=e=>{b||(m(!0),g("string"==typeof e?Error(e):e))};return(0,l.useEffect)(()=>{let t;return e?y?((async()=>{let e=await r.getAccessToken();if(!e)return V("User must be authenticated and have a Privy wallet before it can be connected");try{if(!T){if(!k||!I)return V("For on-device first-class chain wallets, entropyId and entropyIdVerifier are required");await y.connect({accessToken:e,entropyId:k,entropyIdVerifier:I})}A&&await y.verifyMfa({accessToken:e});let r=(Date.now()-f)/1e3;"EmbeddedWalletKeyExportScreen"===C&&r<1?t=setTimeout(()=>{v(C,!1)},1e3*(1-r)):v(C,!1)}catch(t){if((0,i.e)(t)&&"privy"===S){let e=await r.getAccessToken();if(!e)return V("User must be authenticated and have a Privy wallet before it can be recovered");try{d({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:E}});let t=await(null===y||void 0===y?void 0:y.recover({accessToken:e,entropyId:k,entropyIdVerifier:I}));null!==t&&void 0!==t&&t.entropyId||V(Error("Unable to recover wallet")),C?v(C):n({shouldCallAuthOnSuccess:!1}),d({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:E}}),v(C)}catch(t){V("An error has occurred, please try again.")}}else(0,i.e)(t)&&"privy"!==S&&"privy-v2"!==S?(h((0,a.A)((0,a.A)({},p),{},{recoverWallet:{entropyId:k,entropyIdVerifier:I,onCompleteNavigateTo:C,onFailure:g},recoveryOAuthStatus:{provider:S,action:"recover",isInAccountCreateFlow:!1,shouldCreateEth:!1,shouldCreateSol:!1}})),v((0,i.c)(S))):V(t)}})(),()=>clearTimeout(t)):void 0:V("User must be authenticated and have a Privy wallet before it can be connected")},[e,t,y]),w.current=()=>{V("User exited before wallet could be connected"),n({shouldCallAuthOnSuccess:!1})},(0,o.jsx)(u,{connectionFailed:b,onClose:()=>n({shouldCallAuthOnSuccess:!1})})}}}}]);