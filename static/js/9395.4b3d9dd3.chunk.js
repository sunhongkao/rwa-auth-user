"use strict";(self.webpackChunkprivy_atuh=self.webpackChunkprivy_atuh||[]).push([[9395],{89395(e,o,t){t.r(o),t.d(o,{MfaAuthVerifyFlowScreen:()=>n,default:()=>n});var r=t(85089),i=t(58661),s=t(52034),a=t(67793);t(72025),t(15546),t(99130),t(15656),t(56348);const n={component:()=>{var e,o;let{user:t}=(0,s.u)(),{data:n}=(0,s.a)(),[l,d]=(0,i.useState)(null===t||void 0===t?void 0:t.mfaMethods[0]),[u,c]=(0,i.useState)(!1),[f,v]=(0,i.useState)(),[h,y]=(0,i.useState)();if((0,i.useEffect)(()=>{d(null===t||void 0===t?void 0:t.mfaMethods[0])},[null===t||void 0===t?void 0:t.mfaMethods]),null===n||void 0===n||!n.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:m,onSuccess:p,generateOptions:k,verifyTotpCode:w,verifyPasskey:S,verifySmsCode:g,sendSmsCode:M}=n.mfaVerify,C=async e=>{if("passkey"!==e)try{d(e),"sms"===e&&(d(e),await M()),"totp"===e&&d(e)}catch(e){console.error(e)}else try{d(e);let o=await k();if(!o)throw Error("something went wrong");v(o),await S(o),c(!0),y(void 0),p()}catch(e){y((0,a.t)(e))}},E=async e=>{y(void 0);try{if(!e||!l)return;if("passkey"===l){if(!f)throw Error("Missing passkey challenge");await S(f)}else"sms"===l?await g(e):"totp"===l&&await w(e);y(void 0),c(!0),p()}catch(e){throw(0,a.t)(e).error}},b=()=>{var e;h||!u?m(null!==(e=null===h||void 0===h?void 0:h.error)&&void 0!==e?e:Error("Canceled MFA verification.")):p()},A=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{!A.current&&l&&(A.current=!0,C(l).finally(()=>{A.current=!1}))},[open]),t?"passkey"===l?(0,r.jsx)(a.V,{account:t.linkedAccounts.filter(e=>"passkey"===e.type&&e.enrolledInMfa).sort((e,o)=>o.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf())[0],submitSuccess:u,hasBlockingError:null!==(e=null===h||void 0===h?void 0:h.isBlocking)&&void 0!==e&&e,error:null===h||void 0===h?void 0:h.error,onClose:b,onBack:()=>{d(void 0),y(void 0)},handleSubmit:()=>E(f).catch(y)}):"sms"===l||"totp"===l?(0,r.jsx)(a.a,{selectedMethod:l,submitSuccess:u,hasBlockingError:null!==(o=null===h||void 0===h?void 0:h.isBlocking)&&void 0!==o&&o,handleSubmitCode:E,onClose:b,onBack:t.mfaMethods.length>1?()=>d(void 0):void 0}):(0,r.jsx)(a.b,{user:t,onSelect:C,handleClose:b}):null}}}}]);